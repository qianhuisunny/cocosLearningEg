{"version":3,"sources":["../../../../assets/Script/assets/Script/stageManager.js"],"names":["playerClass","require","cc","Class","extends","Component","properties","blockManager","Node","blockList","Prefab","playerUser","blockTemplate","init","removeAllChildren","destroy","block","instantiate","addChild","position","initblockPos","blockjs","getComponent","currBlock","nextBlock","proportionality","onLoad","minDistance","maxDistance","playerLeftOrigin","getWorldPlayerPos","playerRightOrigin","v2","x","y","addBlock","index","Math","floor","random","length","distance","direction","getDirection","node","moveStage","userWorldPos","moveV2","sub","stageMove","action","moveTo","seq","sequence","callFunc","runAction","update","dt"],"mappings":"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","file":"stageManager.js","sourceRoot":"../../../../assets/Script","sourcesContent":["let playerClass = require('player');\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        blockManager: cc.Node,\n        blockList: [cc.Prefab],\n        playerUser: playerClass,\n        blockTemplate: cc.Node\n    },\n\n    init(){\n        this.blockManager.removeAllChildren();\n        this.blockTemplate.destroy();\n        let block = cc.instantiate(this.blockList[0]);\n        this.blockManager.addChild(block);\n        block.position = this.initblockPos;\n        let blockjs = block.getComponent('block');\n        this.currBlock = blockjs;\n        this.nextBlock = blockjs;\n        this.proportionality = 0.556; //Y轴斜率\n    },\n\n    onLoad () {\n        this.initblockPos = this.blockTemplate.position;\n        this.currBlock = null;\n        this.nextBlock = null;\n        this.minDistance = 200;\n        this.maxDistance = 400;\n        this.playerLeftOrigin = this.playerUser.getWorldPlayerPos();\n        this.playerRightOrigin = cc.v2();\n        this.playerRightOrigin.x = this.playerLeftOrigin.x + 350;\n        this.playerRightOrigin.y = this.playerLeftOrigin.y;\n        this.init();\n    },\n\n    addBlock(){\n        let index = Math.floor(Math.random() * this.blockList.length);\n        let block = cc.instantiate(this.blockList[index]);\n        this.blockManager.addChild(block);\n\n        let blockjs = block.getComponent('block');\n\n        let distance = this.minDistance + (Math.random() * this.maxDistance - this.minDistance);\n        let direction = this.playerUser.getDirection();\n\n        if(direction > 0){\n            block.x = this.currBlock.node.x + distance;\n        }else{\n            block.x = this.currBlock.node.x - distance;\n        }\n        block.y = this.currBlock.node.y + distance * this.proportionality;\n\n        this.currBlock = this.nextBlock;\n        this.nextBlock = blockjs;\n    },\n\n    moveStage(){\n        let userWorldPos = this.playerUser.getWorldPlayerPos();\n        let moveV2;\n\n        if(this.playerUser.getDirection() > 0){\n            moveV2 = userWorldPos.sub(this.playerLeftOrigin);\n        }else{\n            moveV2 = userWorldPos.sub(this.playerRightOrigin);\n        }\n\n        let stageMove = this.node.position.sub(moveV2);\n        let action = cc.moveTo(0.4, stageMove);\n\n        let seq = cc.sequence(action,cc.callFunc(() => {\n            this.addBlock();\n        }));\n\n        this.node.runAction(seq);\n\n        \n    },\n\n    update (dt) {\n\n    },\n    \n});\n"]}