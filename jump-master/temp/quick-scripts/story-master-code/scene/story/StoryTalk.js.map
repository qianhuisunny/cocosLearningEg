{"version":3,"sources":["StoryTalk.js"],"names":["TalkSpeed","cc","Enum","Slow1","Slow2","Slow3","Normal","Fast1","Fast2","Fast3","TalkState","Running","Waiting","Over","Class","extends","require","editor","CC_EDITOR","executeInEditMode","playOnFocus","menu","inspector","properties","_bOptions","roleTalkFrame","default","displayName","type","Node","visible","word","Label","talkSpeed","notify","wordIntervalTime","onWordEffect","talkWord","multiline","string","Editor","Ipc","sendToPanel","tooltip","Float","preview","t","onLoad","_initMsg","_getMsgList","StoryMaster","Msg","PieceHasOptions","_onMsg","e","onUserTouch","state","onTalkFast","ObserverMgr","dispatchMsg","OnPieceTalkOver","start","unschedule","_updateWord","schedule","index","allWord","_updateWordByIndex","length","onTalkOver","scheduleOnce","bind","PieceShowOptions","slice"],"mappings":"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","file":"StoryTalk.js","sourceRoot":"../../../../../../../../.CocosCreator/packages/story-master/code/scene/story","sourcesContent":["let TalkSpeed=cc.Enum({Slow1:7,Slow2:6,Slow3:5,Normal:4,Fast1:3,Fast2:2,Fast3:1}),TalkState=cc.Enum({Running:1,Waiting:2,Over:3});cc.Class({extends:require(\"Observer\"),editor:CC_EDITOR&&{executeInEditMode:!0,playOnFocus:!0,menu:\"A-StoryMaster/StoryTalk\",inspector:\"packages://story-master/inspector/StoryTalk.js\"},properties:{_bOptions:!1,roleTalkFrame:{default:null,displayName:\"对话背景框\",type:cc.Node,visible:!1},word:{default:null,displayName:\"对话内容\",type:cc.Label,visible:!1},talkSpeed:{default:TalkSpeed.Normal,displayName:\"语速\",type:TalkSpeed,notify(){this.wordIntervalTime=.05*this.talkSpeed,this.onWordEffect()}},talkWord:{default:\"\",displayName:\"对话\",multiline:!0,notify(){this.word.string=this.talkWord,CC_EDITOR&&Editor.Ipc.sendToPanel(\"story-master.piece\",\"updatePieceTalkWord\",this.talkWord)}},wordIntervalTime:{tooltip:\"每个字符出现的间隔时间\",default:.1,displayName:\"间隔时间\",type:cc.Float,visible:!1},preview:{default:\"0\",notify:CC_EDITOR&&function(t){this.onWordEffect()}}},onLoad(){CC_EDITOR||(this._initMsg(),this.onWordEffect())},_getMsgList:()=>[cc.StoryMaster.Msg.PieceHasOptions],_onMsg(t,e){t===cc.StoryMaster.Msg.PieceHasOptions&&(this._bOptions=!0)},onUserTouch(){this.state===TalkState.Running?this.onTalkFast():this.state===TalkState.Waiting||this.state===TalkState.Over&&(this._bOptions||cc.ObserverMgr.dispatchMsg(cc.StoryMaster.Msg.OnPieceTalkOver,null))},start(){},onTalkFast(){this.wordIntervalTime=.03,this.unschedule(this._updateWord),this.schedule(this._updateWord,this.wordIntervalTime)},onWordEffect(){if(this.word){this.state=TalkState.Running;let t=this.wordIntervalTime;this.index=0,this.allWord=this.word.string,this.unschedule(this._updateWord),this.schedule(this._updateWord,t),this._updateWord()}},_updateWord(){this._updateWordByIndex(this.index),this.index++,this.index>=this.allWord.length&&this.onTalkOver()},onTalkOver(){this.state=TalkState.Waiting,this.unschedule(this._updateWord),this.word.string=this.allWord,this.scheduleOnce(function(){this.state=TalkState.Over}.bind(this),.3),this._bOptions&&cc.ObserverMgr.dispatchMsg(cc.StoryMaster.Msg.PieceShowOptions,null)},_updateWordByIndex(t){if(this.allWord&&t<this.allWord.length){let e=this.allWord.slice(0,t);this.word.string=e}}});"]}